# WakeGuard

**WakeGuard** 是一个轻量级的 Windows 后台管理工具，旨在解决 Windows 在睡眠状态下容易被鼠标、键盘或 USB 集线器意外唤醒的问题。

## 🛑 痛点 (Why WakeGuard?)

在 Windows 睡眠时，系统默认允许鼠标和键盘唤醒电脑。这导致了以下常见问题：
* **背包误触**：笔记本塞进背包后，无线鼠标在包内受挤压或晃动，导致电脑意外唤醒。
* **过热与掉电**：电脑在密闭空间内运行，导致严重发热和电池耗尽。
* **ID 变动**：虽然可以在设备管理器中手动关闭唤醒权限，但一旦更换 USB 接口或驱动更新，设备 ID 变更，唤醒权限又会被重置为默认开启。

## ⚡ 功能特性 (Features)

* **全自动巡逻**：后台服务每 5 秒检查一次系统唤醒列表 (`wake_armed`)。
* **智能屏蔽**：自动识别并禁用鼠标 (Mouse)、键盘 (Keyboard) 和 USB 控制器 (Hub) 的唤醒权限。
* **白名单保护**：**绝对不会** 误杀网卡 (Ethernet/Wi-Fi)，确保 **Wake-on-LAN (WoL)** 和远程桌面功能不受影响。
* **无感运行**：基于 PowerShell 的轻量级后台任务，资源占用几乎为零。
* **即插即防**：无论你更换哪个 USB 接口，设备一旦插入，5秒内其唤醒权限即被封锁。
* **无痕卸载**：卸载时自动恢复所有设备的默认唤醒权限，不留垃圾。

## 🚀 使用方法 (Usage)

### 安装 (Install)
1.  下载本仓库文件到本地文件夹（建议放在固定位置，如 `C:\Tools\WakeGuard`）。
2.  双击运行 **`WakeGuard_Control.bat`**。
3.  输入 `1` 并回车，脚本会自动部署后台任务。

### 验证 (Verify)
1.  安装完成后，你的鼠标/键盘唤醒功能应已被禁用。
2.  你可以尝试在控制台中输入 `4` 查看当前允许唤醒的设备列表。
    * **正常状态**：列表中应该只显示网卡（如 `Realtek Gaming GbE Family Controller`）。
    * 如果你尝试手动开启鼠标唤醒，5秒后它会自动消失。

### 卸载 (Uninstall)
1.  双击运行 **`WakeGuard_Control.bat`**。
2.  输入 `2` 并回车。
3.  服务将被停止并移除，同时**自动恢复**鼠标和键盘的唤醒功能。

## 📂 文件说明

* `WakeGuard.ps1`: 核心逻辑脚本，负责后台巡逻和权限管理。
* `WakeGuard_Control.bat`: 用户交互控制台，用于一键安装、卸载和查看日志。

## 🛠️ 技术细节

* **运行机制**：通过 Windows 任务计划程序 (Task Scheduler) 在用户登录时启动一个隐藏的 PowerShell 进程。
* **权限**：安装和运行需要管理员权限 (`RunAsAdmin`)。
* **日志**：运行日志存储于 `C:\ProgramData\WakeGuard\WakeGuard.log`。

## 📄 License

MIT License